# 项目名称：考研离线背单词助手 开发需求文档 - 安卓版
## 1. 项目概述
### 1.1 项目背景
目标用户为考研学生，核心痛点为：图书馆/自习室网络不稳定、需要专注静音学习、需要根据复习进度灵活切换词书（如从大纲词汇切换到真题生词）。
### 1.2 核心目标
1.  **安卓原生架构**：采用Kotlin语言，利用Jetpack组件构建高性能应用。
2.  **全离线运行**：无需网络权限，零依赖外部资源（无发音、无广告、无联网请求）。
3.  **灵活词书切换**：支持在多本词书（预置/自定义）及生词本之间无缝切换。
4.  **生词本管理**：提供独立的生词收集与学习入口。
### 1.3 技术栈
*   **开发语言**：Kotlin
*   **UI框架**：Jetpack Compose (推荐) 或 XML + ViewBinding
*   **数据库**：Room Database (SQLite封装)
*   **异步处理**：Kotlin Coroutines + Flow
*   **文件处理**：Android Storage Access Framework (SAF) 用于导入词书
---
## 2. 功能模块详细设计
### 2.1 词书管理与切换功能
此功能允许用户像切换游戏关卡一样切换学习内容。
*   **词书列表**：
    *   展示所有可用词书（包括预置词书、用户导入词书）。
    *   显示每本词书的学习进度（已学/总词数）。
    *   标识当前“激活”的词书。
*   **切换逻辑**：
    *   **一键切换**：点击词书右侧的“使用”按钮，将该词书设为当前学习对象。
    *   **状态保持**：切换词书不应丢失之前词书的学习进度，下次切回时应恢复原进度。
*   **自定义导入**：
    *   点击“导入新词书”。
    *   调用系统文件选择器。
    *   解析TXT/CSV文件，生成新的词书条目及对应的单词数据。
### 2.2 生词本功能
生词本作为一本“特殊的动态词书”存在。
*   **添加入口**：
    *   **查词页面**：搜索单词时，点击“加入生词本”按钮。
    *   **学习页面**：在背单词过程中，点击“标记为生词”或“太难点”按钮，自动加入生词本。
*   **生词本特性**：
    *   **独立入口**：在主页或词书列表中，显示为独立的一本词书（书名：生词本）。
    *   **双向同步**：单词被掌握后可从生词本移除；生词本中的词可单独进行复习。
    *   **去重机制**：添加生词时，检查是否已存在，避免重复。
### 2.3 核心学习流程
*   **卡片展示**：大字号显示单词、音标，点击翻转显示释义与例句。
*   **交互逻辑**：
    *   **认识**：进入下一词，调度算法推迟复习时间。
    *   **模糊/不认识**：显示释义详情，进入下一词，调度算法安排近期复习。
    *   **移出生词本**：若在生词本模式下点击“认识”，提示是否移出。
*   **视觉记忆**：无发音按钮，界面纯净。
---
## 3. 数据库设计
使用 Room Database，需包含以下实体：
### 3.1 词书表
*   `id` (Long, Primary Key)
*   `name` (String) - 词书名称（如“考研大纲”、“生词本”）
*   `type` (Int) - 类型：0(预置), 1(用户导入), 2(生词本)
*   `total_count` (Int) - 总词数
*   `is_active` (Boolean) - 是否当前激活
### 3.2 单词表
*   `id` (Long, Primary Key)
*   `word` (String) - 单词
*   `phonetic` (String) - 音标
*   `meaning` (String) - 释义
*   `example` (String) - 例句
*   `book_id` (Long, Foreign Key) - 所属词书ID
### 3.3 学习进度表
*   `id` (Long, Primary Key)
*   `word_id` (Long)
*   `book_id` (Long) - 关联词书，用于区分同一单词在不同词书中的进度
*   `status` (Int) - 状态：0(新词), 1(学习中), 2(已掌握)
*   `next_review_time` (Long) - 时间戳
*   `ease_factor` (Float) - 记忆因子
### 3.4 生词本关联表
*   `id` (Long, Primary Key)
*   `word_id` (Long) - 关联单词ID
*   `add_time` (Long) - 添加时间
*   `note` (String) - 用户备注（可选）
---
## 4. 安卓专属UI/UX设计
### 4.1 界面结构
采用单Activity多Fragment架构，底部导航栏包含四个Tab：
1.  **学习**：
    *   顶部显示当前词书名称（点击可弹出词书切换抽屉）。
    *   中部单词卡片。
    *   底部操作按钮。
2.  **查词**：
    *   搜索框 + 本地词典列表。
    *   搜索结果页含“加入生词本”图标。
3.  **词库**：
    *   列表展示所有词书。
    *   每个Item显示：词书名、进度条、[切换]按钮、[删除]按钮（仅限用户导入）。
    *   右下角悬浮按钮：导入新词书。
4.  **我的**：
    *   学习统计（日历视图）。
    *   数据备份与恢复（导出DB文件到本地）。
    *   关于/设置（字号调整、深色模式）。
### 4.2 词书切换交互
*   **侧滑抽屉**：在学习页左侧滑出，列表显示所有词书，点击即切换，背景变暗。
*   **视觉反馈**：切换成功后，Toast提示“已切换至：XX词书”，并刷新当前单词。
---
## 5. 关键逻辑实现指南 (伪代码/Kotlin思路)
### 5.1 词书切换逻辑
```kotlin
// ViewModel
fun switchBook(newBookId: Long) {
    viewModelScope.launch {
        // 1. 更新数据库状态
        repository.deactivateAllBooks()
        repository.activateBook(newBookId)
        
        // 2. 重置当前学习队列
        currentBookId.value = newBookId
        
        // 3. 加载新词书的第一个单词
        loadNextWord()
    }
}
```
### 5.2 导入词书逻辑
*   **权限**：无需申请存储权限，使用 `Intent.ACTION_OPEN_DOCUMENT` 获取文件Uri。
*   **解析**：使用 `BufferedReader` 读取流，正则或Split分割单词与释义。
*   **事务处理**：使用 `@Transaction` 注解，批量插入单词数据，防止数据丢失。
### 5.3 生词本添加逻辑
```kotlin
fun addToNewWordsBook(wordId: Long) {
    // 1. 检查“生词本”是否存在，不存在则创建（type=2）
    val newWordsBook = repository.getOrCreateNewWordsBook()
    
    // 2. 检查单词是否已在生词本中（去重）
    if (!repository.existsInBook(wordId, newWordsBook.id)) {
        // 3. 复制一份单词数据到生词本ID下 (或者仅做关联)
        // 为简化逻辑，建议在 tb_dictionary 中新增一条记录，book_id 指向生词本
        val originalWord = repository.getWordById(wordId)
        val newWordEntry = originalWord.copy(id=0, book_id = newWordsBook.id)
        repository.insertWord(newWordEntry)
        
        // 4. 提示用户
        _toastMessage.value = "已添加至生词本"
    }
}
```
---
## 6. 交付清单
请AI开发者生成一个完整的Android Studio工程，包含：
1.  **Model层**：Room数据库实体、DAO接口、Database类。
2.  **Repository层**：封装数据操作，处理词书切换与生词本逻辑。
3.  **ViewModel层**：管理UI状态，处理协程。
4.  **UI层**：
    *   `LearningScreen` (Compose) 或 `LearningFragment` (XML)。
    *   `BookManageScreen` (含切换、导入功能)。
    *   `SearchScreen` (含加入生词本功能)。
5.  **Assets**：预置的 `vocabulary.db` 文件（需在首次启动时复制到应用数据库目录）。
6.  **Utils**：文件解析工具类、SM-2算法工具类。
---
**特别说明：**
*   需处理Android 10+的分区存储限制，导入导出文件务必使用SAF框架。
*   生词本应当是一个“虚拟词书”，在词库管理页面可见且不可删除（但可清空内容）。

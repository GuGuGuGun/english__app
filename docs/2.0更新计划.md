# 2.0 更新任务计划：考研离线背单词助手（Android）

## 目标与范围
- 在 V1.0 基础上新增三大核心模块：**学习数据可视化**、**拼写练习功能**、**复习时间可视化**。
- 增强用户对学习效果的直观感知，强化主动拼写记忆能力，提升学习掌控感。
- 涉及数据库表结构扩展、新增页面与组件、现有页面改造。

## 约束与原则
- 技术栈延续 V1.0：Kotlin + Jetpack Compose + Room + Coroutines/Flow。
- 新增图表依赖：MPAndroidChart 或 Compose-Charts。
- 全离线运行原则不变，不引入网络权限。
- 数据库变更通过 Room Migration 平滑升级，不丢失已有数据。
- 复习时间统一使用 UTC 时间戳存储，UI 展示时做本地时区转换。
- 拼写功能需处理软键盘弹出的布局重排问题。
- 图表组件需适配深色模式。

## 里程碑
- M7 数据层扩展：数据库迁移与新增实体/DAO。
- M8 复习时间可视化：学习卡片展示下次复习时间及调度说明。
- M9 拼写练习功能：拼写模式完整交互与判定逻辑。
- M10 学习数据可视化：统计图表（记忆曲线、掌握度环形图、日历热力图）。
- M11 现有页面改造：词书列表统计、查词页掌握状态、我的页统计大屏升级。
- M12 UI适配与验收测试：深色模式适配、动效完善、回归测试。

## 详细任务拆解

### 1. 数据层扩展（M7）
- Progress 表新增字段：`review_count`（总复习次数）、`spell_correct_count`（拼写正确次数）、`spell_wrong_count`（拼写错误次数）。
- 新增 DailyStats 实体（学习记录表）：`id`、`date`、`new_words_count`、`review_words_count`、`spell_practice_count`、`duration_millis`。
- 新增 DailyStatsDao：按日期范围查询、按天聚合、当日记录 getOrCreate。
- 编写 Room Migration（从当前版本迁移到新版本）。
- Repository 层新增统计数据操作与拼写记录方法。

### 2. 复习时间可视化（M8）
- SM-2 工具类确保返回计算后的 `nextReviewTime` 时间戳。
- 新增 DateUtils 工具类：时间戳转"今日复习"/"明天复习"/"X天后复习"等友好文案。
- 学习页 WordCard 右上角添加复习时间标签（如"📅 3天后"）。
- 点击复习时间标签弹窗：展示上次复习时间、下次复习时间、SM-2 调度说明。
- 查词详情页展示单词个人掌握状态与下次复习时间。

### 3. 拼写练习功能（M9）
- 学习页顶部新增模式切换 Tabs：[认词模式] / [拼写模式]。
- 新增 SpellingScreen 拼写练习界面：
  - 出题：显示释义和音标，隐藏单词拼写。
  - 作答：输入框 + 软键盘，支持实时字母级纠错提示。
  - 判定：正确（输入框变绿 + 震动 + 自动跳转，SM-2 quality=5）；错误（输入框变红 + 正确拼写对比 + 手动"记住了"，SM-2 quality=2）。
  - 提示功能：显示首字母、显示长度（降低权重）。
- 词库详情页新增"拼写测试"入口按钮。
- 拼写结果写入 Progress 表（spell_correct_count / spell_wrong_count）并更新 DailyStats。

### 4. 学习数据可视化（M10）
- 引入图表库依赖（MPAndroidChart 或 Compose-Charts）。
- 新增 StatsScreen 数据可视化页面：
  - 记忆曲线图：过去 7天/30天 每日复习量与新词量折线图。
  - 掌握度分布：环形图展示"未学"/"学习中"/"已掌握"比例。
  - 日历热力图：类 GitHub 贡献图，颜色深浅代表当天学习量。
- ViewModel 层新增图表数据 StateFlow，封装统计查询逻辑。
- 图表配色适配浅色/深色模式。

### 5. 现有页面改造（M11）
- 词书列表 Item 新增简要统计：已掌握率、预计复习单词数。
- 词书详情页新增统计区：展示该词书掌握度环形图。
- 我的页统计大屏升级：
  - 替换/增强为日历热力图 + 过去一周趋势图。
  - 展示拼写练习统计数据。
- 查词结果页显示单词个人掌握状态（如"已掌握，下次复习：无"）。

### 6. UI适配与验收测试（M12）
- 所有新增组件深色模式适配验证。
- 拼写界面软键盘弹出布局测试（不同屏幕尺寸）。
- 时区处理验证：UTC 存储 + 本地展示一致性。
- 数据库迁移测试：从 V1 升级不丢失数据。
- 新增 Compose UI 验收测试：拼写流程、图表渲染、复习时间展示。
- 核心流程回归测试：学习、查词、词库管理、我的。

## 交付物
- 更新后的 Android Studio 工程与可运行 APK。
- 新增实体：DailyStats、更新 Progress 表结构。
- 新增页面：SpellingScreen、StatsScreen。
- 新增工具类：DateUtils。
- 图表库集成与深色模式适配。
- 数据库迁移脚本。
- 更新文档：开发进度记录、README。

## 开发进度记录要求
- 记录文件：docs/开发进度记录.md。
- 记录频率：每个里程碑（M7-M12）完成后更新。
- 记录内容：完成内容、待办、风险/阻塞、下一步。
- 如与计划偏差，需记录原因与调整方案。

## 记录模板
- 日期：
- 阶段/模块：
- 完成内容：
- 待办：
- 风险/阻塞：
- 下一步：
